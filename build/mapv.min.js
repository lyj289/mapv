!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.mapv=t.mapv||{})}(this,function(t){"use strict";var p=function(t){t&&t.clearRect&&t.clearRect(0,0,t.canvas.width,t.canvas.height)};function n(){this._subscribers={}}n.prototype.on=function(t,e){var n=this._subscribers[t];n||(n=[],this._subscribers[t]=n),n.push({callback:e})},n.prototype.off=function(t,e){var n=this._subscribers[t];if(n)for(var i=0;i<n.length;i++)n[i].callback==e&&(n.splice(i,1),i--)},n.prototype._trigger=function(t,e,n){if("*"==t)throw new Error("Cannot trigger event *");var i=[];t in this._subscribers&&(i=i.concat(this._subscribers[t])),"*"in this._subscribers&&(i=i.concat(this._subscribers["*"]));for(var o=0,r=i.length;o<r;o++){var a=i[o];a.callback&&a.callback(t,e,n||null)}};var s=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},e=function(){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}}(),i=function t(e,n,i){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,n,i)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(i):void 0};function B(t,e){n.bind(this)(),this._options=e||{},this._data=[],RTree&&(this._rt=RTree()),t&&this.add(t)}(B.prototype=n.prototype).add=function(t,e){if(this._rt&&this._rt.geoJSON(t),Array.isArray(t))for(var n=0,i=t.length;n<i;n++){if(t[n].time&&14==t[n].time.length&&"20"==t[n].time.substr(0,2)){var o=t[n].time;t[n].time=new Date(o.substr(0,4)+"-"+o.substr(4,2)+"-"+o.substr(6,2)+" "+o.substr(8,2)+":"+o.substr(10,2)+":"+o.substr(12,2)).getTime()}this._data.push(t[n])}else{if(!(t instanceof Object))throw new Error("Unknown dataType");this._data.push(t)}this._dataCache=JSON.parse(JSON.stringify(this._data))},B.prototype.reset=function(){this._data=JSON.parse(JSON.stringify(this._dataCache))},B.prototype.get=function(t){t=t||{};new Date;var e=this._data;new Date;if(t.filter){for(var n=[],i=0;i<e.length;i++)t.filter(e[i])&&n.push(e[i]);e=n}return t.transferCoordinate&&(e=this.transferCoordinate(e,t.transferCoordinate,t.fromColumn,t.toColumn)),e},B.prototype.getByBbox=function(t,e){return this._rt.bbox([t.lng,t.lat],[e.lng,e.lat])},B.prototype.set=function(t){this._set(t),this._trigger("change")},B.prototype._set=function(t){this.clear(),this.add(t)},B.prototype.clear=function(t){this._data=[],this._rt&&(this._rt=RTree())},B.prototype.remove=function(t){},B.prototype.update=function(t,e){for(var n=this._data,i=0;i<n.length;i++)if(e){var o=!0;for(var r in e)n[i][r]!=e[r]&&(o=!1);o&&t&&t(n[i])}else t&&t(n[i]);this._dataCache=JSON.parse(JSON.stringify(this._data)),this._trigger("change")},B.prototype.transferCoordinate=function(t,a,e,n){n=n||"_coordinates",e=e||"coordinates";for(var i=0;i<t.length;i++){var o=t[i].geometry,r=o[e];switch(o.type){case"Point":o[n]=a(r);break;case"LineString":for(var s=[],l=0;l<r.length;l++)s.push(a(r[l]));o[n]=s;break;case"Polygon":s=c(r);o[n]=s;break;case"MultiPolygon":s=[];for(var h=0;h<r.length;h++){var u=c(u=r[h]);s.push(u)}o[n]=s}}function c(t){for(var e=[],n=0;n<t.length;n++){for(var i=t[n],o=[],r=0;r<i.length;r++)o.push(a(i[r]));e.push(o)}return e}return t},B.prototype.initGeometry=function(e){e?this._data.forEach(function(t){t.geometry=e(t)}):this._data.forEach(function(t){t.geometry||t.lng&&t.lat&&(t.geometry={type:"Point",coordinates:[t.lng,t.lat]})})},B.prototype.getMax=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var n=parseFloat(e[0][t]),i=1;i<e.length;i++){var o=parseFloat(e[i][t]);n<o&&(n=o)}return n}},B.prototype.getSum=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var n=0,i=0;i<e.length;i++)e[i][t]&&(n+=parseFloat(e[i][t]));return n}},B.prototype.getMin=function(t){var e=this._data;if(e&&!(e.length<=0)){for(var n=parseFloat(e[0][t]),i=1;i<e.length;i++){var o=parseFloat(e[i][t]);o<n&&(n=o)}return n}},B.prototype.getUnique=function(t){if((i=this._data)&&!(i.length<=0)){for(var e={},n=1;n<i.length;n++)e[i[n][t]]=!0;var i=[];for(var o in e)i.push(o);return i}};var m={drawDataSet:function(t,e,n){for(var i=e instanceof B?e.get():e,o=0,r=i.length;o<r;o++){var a=i[o];this.draw(t,a,n)}},draw:function(t,e,n){var i=e.geometry.type,o=e.geometry._coordinates||e.geometry.coordinates,r=n.symbol||"circle";switch(i){case"Point":var a=e._size||e.size||n._size||n.size||5;"circle"===r?("Point"===n.bigData&&t.moveTo(o[0],o[1]),t.arc(o[0],o[1],a,0,2*Math.PI)):"rect"===r?t.rect(o[0]-a/2,o[1]-a/2,a,a):"honeycomb"===r&&function(t,e,n,i){for(var o=0;o<6;o++){var r=(a={x:e,y:n},s=i,l=60*o+30,h=Math.PI/180*l,[a.x+s*Math.cos(h),a.y+s*Math.sin(h)]);t.lineTo(r[0],r[1])}var a,s,l,h}(t,o[0],o[1],a);break;case"LineString":for(var s=0;s<o.length;s++){var l=o[s][0],h=o[s][1];0==s?t.moveTo(l,h):t.lineTo(l,h)}break;case"Polygon":this.drawPolygon(t,o);break;case"MultiPolygon":for(var u=0;u<o.length;u++){var c=o[u];this.drawPolygon(t,c)}t.closePath();break;default:console.log("type"+i+"is not support now!")}},drawPolygon:function(t,e){for(var n=0;n<e.length;n++){var i=e[n];t.moveTo(i[0][0],i[0][1]);for(var o=1;o<i.length;o++)t.lineTo(i[o][0],i[o][1]);t.lineTo(i[0][0],i[0][1])}}},r={draw:function(t,e,n){var i=e instanceof B?e.get():e;for(var o in t.save(),n)t[o]=n[o];if(n.bigData){t.save(),t.beginPath();for(var r=0,a=i.length;r<a;r++){var s=i[r];m.draw(t,s,n)}"Point"==(l=n.bigData)||"Polygon"==l||"MultiPolygon"==l?(t.fill(),t.lineDash&&t.setLineDash(t.lineDash),s.lineDash&&t.setLineDash(s.lineDash),(s.strokeStyle||n.strokeStyle)&&n.lineWidth&&t.stroke()):"LineString"==l&&t.stroke(),t.restore()}else for(r=0,a=i.length;r<a;r++){s=i[r];t.save(),(s.fillStyle||s._fillStyle)&&(t.fillStyle=s.fillStyle||s._fillStyle),(s.strokeStyle||s._strokeStyle)&&(t.strokeStyle=s.strokeStyle||s._strokeStyle),t.lineDash&&t.setLineDash(t.lineDash),s.lineDash&&t.setLineDash(s.lineDash);var l=s.geometry.type;t.beginPath(),m.draw(t,s,n),"Point"==l||"Polygon"==l||"MultiPolygon"==l?(t.fill(),(s.strokeStyle||n.strokeStyle)&&n.lineWidth&&t.stroke()):"LineString"==l&&((s.lineWidth||s._lineWidth)&&(t.lineWidth=s.lineWidth||s._lineWidth),t.stroke()),t.restore()}t.restore()}},o=function(){function a(t,e,n){if(s(this,a),!t||!e)return console.warn("id 和 type 为必填项"),!1;if("baidu"==e){if(!BMap)return console.warn("请先引入百度地图JS API"),!1}else console.warn("暂不支持你的地图类型");this.type=e;var i=n&&n.center?n.center:[106.962497,38.208726],o=n&&n.zoom?n.zoom:5,r=this.map=new BMap.Map(t,{enableMapClick:!1});r.centerAndZoom(new BMap.Point(i[0],i[1]),o),r.enableScrollWheelZoom(!0),r.setMapStyle({style:"light"})}return e(a,[{key:"addLayer",value:function(t,e){if("baidu"==this.type)return new mapv.baiduMapLayer(this.map,dataSet,e)}},{key:"getMap",value:function(){return this.map}}]),a}();function l(t){this.options=t||{},this.paneName=this.options.paneName||"mapPane",this.context=this.options.context||"2d",this.zIndex=this.options.zIndex||0,this.mixBlendMode=this.options.mixBlendMode||null,this.enableMassClear=this.options.enableMassClear,this._map=t.map,this._lastDrawTime=null,this.show()}var a="undefined"==typeof window?{}:window;a.BMap&&((l.prototype=new BMap.Overlay).initialize=function(t){this._map=t;var e=this.canvas=document.createElement("canvas");e.style.cssText="position:absolute;left:0;top:0;z-index:"+this.zIndex+";user-select:none;",e.style.mixBlendMode=this.mixBlendMode,this.adjustSize(),t.getPanes()[this.paneName].appendChild(e);var n=this;return t.addEventListener("resize",function(){n.adjustSize(),n._draw()}),this.canvas},l.prototype.adjustSize=function(){var t=this._map.getSize(),e=this.canvas,n=this.devicePixelRatio=a.devicePixelRatio||1;e.width=t.width*n,e.height=t.height*n,"2d"==this.context&&e.getContext(this.context).scale(n,n),e.style.width=t.width+"px",e.style.height=t.height+"px"},l.prototype.draw=function(){var t=this;clearTimeout(t.timeoutID),t.timeoutID=setTimeout(function(){t._draw()},15)},l.prototype._draw=function(){var t=this._map;this.canvas.style.left=-t.offsetX+"px",this.canvas.style.top=-t.offsetY+"px",this.dispatchEvent("draw"),this.options.update&&this.options.update.apply(this,arguments)},l.prototype.getContainer=function(){return this.canvas},l.prototype.show=function(){this.canvas||this._map.addOverlay(this),this.canvas.style.display="block"},l.prototype.hide=function(){this.canvas.style.display="none"},l.prototype.setZIndex=function(t){this.zIndex=t,this.canvas.style.zIndex=this.zIndex},l.prototype.getZIndex=function(){return this.zIndex});var h,u,E=E||(h=[],{getAll:function(){return h},removeAll:function(){h=[]},add:function(t){h.push(t)},remove:function(t){var e=h.indexOf(t);-1!==e&&h.splice(e,1)},update:function(t,e){if(0===h.length)return!1;var n=0;for(t=void 0!==t?t:E.now();n<h.length;)h[n].update(t)||e?n++:h.splice(n,1);return!0}});function w(t,e){if("undefined"==typeof document);else{var n=document.createElement("canvas");t&&(n.width=t),e&&(n.height=e)}return n}function z(t){t=t||{},this.gradient=t.gradient||{.25:"rgba(0, 0, 255, 1)",.55:"rgba(0, 255, 0, 1)",.85:"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"},this.maxSize=t.maxSize||35,this.minSize=t.minSize||0,this.max=t.max||100,this.min=t.min||0,this.initPalette()}function c(t){this.splitList=t||{other:1}}function f(t){this.splitList=t||[{start:0,value:"red"}]}"undefined"==typeof window&&"undefined"!=typeof process?E.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?E.now=window.performance.now.bind(window.performance):void 0!==Date.now?E.now=Date.now:E.now=function(){return(new Date).getTime()},E.Tween=function(t){var h,u=t,c={},f={},p={},v=1e3,d=0,g=!1,n=!1,y=!1,x=0,m=null,w=E.Easing.Linear.None,b=E.Interpolation.Linear,_=[],S=null,M=!1,P=null,k=null,e=null;this.to=function(t,e){return f=t,void 0!==e&&(v=e),this},this.start=function(t){for(var e in E.add(this),M=!(n=!0),m=void 0!==t?t:E.now(),m+=x,f){if(f[e]instanceof Array){if(0===f[e].length)continue;f[e]=[u[e]].concat(f[e])}void 0!==u[e]&&(c[e]=u[e],c[e]instanceof Array==!1&&(c[e]*=1),p[e]=c[e]||0)}return this},this.stop=function(){return n&&(E.remove(this),n=!1,null!==e&&e.call(u,u),this.stopChainedTweens()),this},this.end=function(){return this.update(m+v),this},this.stopChainedTweens=function(){for(var t=0,e=_.length;t<e;t++)_[t].stop()},this.delay=function(t){return x=t,this},this.repeat=function(t){return d=t,this},this.repeatDelay=function(t){return h=t,this},this.yoyo=function(t){return g=t,this},this.easing=function(t){return w=t,this},this.interpolation=function(t){return b=t,this},this.chain=function(){return _=arguments,this},this.onStart=function(t){return S=t,this},this.onUpdate=function(t){return P=t,this},this.onComplete=function(t){return k=t,this},this.onStop=function(t){return e=t,this},this.update=function(t){var e,n,i;if(t<m)return!0;for(e in!1===M&&(null!==S&&S.call(u,u),M=!0),i=w(n=1<(n=(t-m)/v)?1:n),f)if(void 0!==c[e]){var o=c[e]||0,r=f[e];r instanceof Array?u[e]=b(r,i):("string"==typeof r&&(r="+"===r.charAt(0)||"-"===r.charAt(0)?o+parseFloat(r):parseFloat(r)),"number"==typeof r&&(u[e]=o+(r-o)*i))}if(null!==P&&P.call(u,i),1===n){if(0<d){for(e in isFinite(d)&&d--,p){if("string"==typeof f[e]&&(p[e]=p[e]+parseFloat(f[e])),g){var a=p[e];p[e]=f[e],f[e]=a}c[e]=p[e]}return g&&(y=!y),m=void 0!==h?t+h:t+x,!0}null!==k&&k.call(u,u);for(var s=0,l=_.length;s<l;s++)_[s].start(m+v);return!1}return!0}},E.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){return t*t*(2.70158*t-1.70158)},Out:function(t){return--t*t*(2.70158*t+1.70158)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-E.Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*E.Easing.Bounce.In(2*t):.5*E.Easing.Bounce.Out(2*t-1)+.5}}},E.Interpolation={Linear:function(t,e){var n=t.length-1,i=n*e,o=Math.floor(i),r=E.Interpolation.Utils.Linear;return e<0?r(t[0],t[1],i):1<e?r(t[n],t[n-1],n-i):r(t[o],t[n<o+1?n:o+1],i-o)},Bezier:function(t,e){for(var n=0,i=t.length-1,o=Math.pow,r=E.Interpolation.Utils.Bernstein,a=0;a<=i;a++)n+=o(1-e,i-a)*o(e,a)*t[a]*r(i,a);return n},CatmullRom:function(t,e){var n=t.length-1,i=n*e,o=Math.floor(i),r=E.Interpolation.Utils.CatmullRom;return t[0]===t[n]?(e<0&&(o=Math.floor(i=n*(1+e))),r(t[(o-1+n)%n],t[o],t[(o+1)%n],t[(o+2)%n],i-o)):e<0?t[0]-(r(t[0],t[0],t[1],t[1],-i)-t[0]):1<e?t[n]-(r(t[n],t[n],t[n-1],t[n-1],i-n)-t[n]):r(t[o?o-1:0],t[o],t[n<o+1?n:o+1],t[n<o+2?n:o+2],i-o)},Utils:{Linear:function(t,e,n){return(e-t)*n+t},Bernstein:function(t,e){var n=E.Interpolation.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:(u=[1],function(t){var e=1;if(u[t])return u[t];for(var n=t;1<n;n--)e*=n;return u[t]=e}),CatmullRom:function(t,e,n,i,o){var r=.5*(n-t),a=.5*(i-e),s=o*o;return(2*e-2*n+r+a)*(o*s)+(-3*e+3*n-2*r-a)*s+r*o+e}}},z.prototype.setMax=function(t){this.max=t||100},z.prototype.setMin=function(t){this.min=t||0},z.prototype.setMaxSize=function(t){this.maxSize=t||35},z.prototype.setMinSize=function(t){this.minSize=t||0},z.prototype.initPalette=function(){var t=this.gradient,e=new w(256,1),n=this.paletteCtx=e.getContext("2d"),i=n.createLinearGradient(0,0,256,1);for(var o in t)i.addColorStop(parseFloat(o),t[o]);n.fillStyle=i,n.fillRect(0,0,256,1)},z.prototype.getColor=function(t){var e=this.getImageData(t);return"rgba("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]/256+")"},z.prototype.getImageData=function(t){var e=this.paletteCtx.getImageData(0,0,256,1).data;if(void 0===t)return e;var n=this.max,i=this.min;n<t&&(t=n),t<i&&(t=i);var o=4*Math.floor((t-i)/(n-i)*255);return[e[o],e[o+1],e[o+2],e[o+3]]},z.prototype.getSize=function(t){var e=this.max,n=this.min,i=this.maxSize,o=this.minSize;return e<t&&(t=e),t<n&&(t=n),o+(t-n)/(e-n)*(i-o)},z.prototype.getLegend=function(t){var e=this.gradient,n=t.width||20,i=t.height||180,o=new w(n,i),r=o.getContext("2d"),a=r.createLinearGradient(0,i,0,0);for(var s in e)a.addColorStop(parseFloat(s),e[s]);return r.fillStyle=a,r.fillRect(0,0,n,i),o},c.prototype.get=function(t){var e=this.splitList,n=e.other;for(var i in e)if(t==i){n=e[i];break}return n},c.prototype.generateByDataSet=function(t,e){var n=e||["rgba(255, 255, 0, 0.8)","rgba(253, 98, 104, 0.8)","rgba(255, 146, 149, 0.8)","rgba(255, 241, 193, 0.8)","rgba(110, 176, 253, 0.8)","rgba(52, 139, 251, 0.8)","rgba(17, 102, 252, 0.8)"],i=t.get();this.splitList={};for(var o=0,r=0;r<i.length&&(void 0===this.splitList[i[r].count]&&(this.splitList[i[r].count]=n[o],o++),!(o>=n.length-1));r++);this.splitList.other=n[n.length-1]},c.prototype.getLegend=function(t){var e=this.splitList,n=document.createElement("div");n.style.cssText="background:#fff; padding: 5px; border: 1px solid #ccc;";var i="";for(var o in e)i+='<div style="line-height: 19px;" value="'+o+'"><span style="vertical-align: -2px; display: inline-block; width: 30px;height: 19px;background:'+e[o]+';"></span><span style="margin-left: 3px;">'+o+"<span></div>";return n.innerHTML=i,n},f.prototype.get=function(t){for(var e=this.splitList,n=!1,i=0;i<e.length;i++)if((void 0===e[i].start||void 0!==e[i].start&&t>=e[i].start)&&(void 0===e[i].end||void 0!==e[i].end&&t<e[i].end)){n=e[i].value;break}return n},f.prototype.generateByDataSet=function(t){var e=t.getMin("count"),n=t.getMax("count");this.generateByMinMax(e,n)},f.prototype.generateByMinMax=function(t,e){var n=["rgba(255, 255, 0, 0.8)","rgba(253, 98, 104, 0.8)","rgba(255, 146, 149, 0.8)","rgba(255, 241, 193, 0.8)","rgba(110, 176, 253, 0.8)","rgba(52, 139, 251, 0.8)","rgba(17, 102, 252, 0.8)"],i=Number((e-t)/7);e=Number(e);var o=Number(t);this.splitList=[];for(var r=0;o<e;)this.splitList.push({start:o,end:o+i,value:n[r]}),r++,o+=i},f.prototype.getLegend=function(t){this.splitList};var v=("undefined"==typeof window?{}:window).devicePixelRatio||1;function d(r,t,a){var s=a.max||100,e=a.min||0,n=a._size;null==n&&null==(n=a.size)&&(n=13);var i,o,l,h,u,c=new z({gradient:a.gradient,max:s,min:e}),f=(h=new w(2*(l=(i=n)+(o=i/2)),2*l),(u=h.getContext("2d")).shadowBlur=o,u.shadowColor="black",u.shadowOffsetX=u.shadowOffsetY=1e4,u.beginPath(),u.arc(l-1e4,l-1e4,i,0,2*Math.PI,!0),u.closePath(),u.fill(),h),p=f.width/2,v=f.height/2,d=t,g={};for(var y in d.forEach(function(t,e){var n=void 0===t.count?1:t.count,i=Math.min(1,n/s).toFixed(2);g[i]=g[i]||[],g[i].push(t)}),g)if(!isNaN(y)){var x=g[y];r.beginPath(),a.withoutAlpha||(r.globalAlpha=y),r.strokeStyle=c.getColor(y*s),x.forEach(function(t,e){if(t.geometry){var n=t.geometry._coordinates||t.geometry.coordinates,i=t.geometry.type;if("Point"===i){var o=void 0===t.count?1:t.count;r.globalAlpha=o/s,r.drawImage(f,n[0]-p,n[1]-v)}else if("LineString"===i){o=void 0===t.count?1:t.count;r.globalAlpha=o/s,r.beginPath(),m.draw(r,t,a),r.stroke()}}})}}var g={draw:function(t,e,n){if(!(t.canvas.width<=0||t.canvas.height<=0)){var i=n.strength||.3;t.strokeStyle="rgba(0,0,0,"+i+")";var o=new w(t.canvas.width,t.canvas.height),r=o.getContext("2d");r.scale(v,v),n=n||{};var a=e instanceof B?e.get():e;t.save();var s=new z({gradient:n.gradient});if(d(r,a,n),!n.absolute){var l=r.getImageData(0,0,t.canvas.width,t.canvas.height);!function(t,e,n){for(var i,o=n.maxOpacity||.8,r=3,a=t.length;r<a;r+=4)i=4*t[r],t[r]/256>o&&(t[r]=256*o),t[r-3]=e[i],t[r-2]=e[i+1],t[r-1]=e[i+2]}(l.data,s.getImageData(),n),t.putImageData(l,0,0),t.restore()}o=s=null}}};function y(t,e,n){var i=t.createShader(n);return t.shaderSource(i,e),t.compileShader(i),i}function b(t,e,n){var i=y(t,e,t.VERTEX_SHADER),o=y(t,n,t.FRAGMENT_SHADER),r=t.createProgram();return t.attachShader(r,i),t.attachShader(r,o),t.linkProgram(r),t.useProgram(r),r}function _(t){var e=document.createElement("canvas"),n=e.getContext("2d");return e.width=1,e.height=1,n.fillStyle=t,n.fillRect(0,0,1,1),n.getImageData(0,0,1,1).data}var S=["attribute vec4 a_Position;","void main() {","gl_Position = a_Position;","gl_PointSize = 30.0;","}"].join(""),M=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join("");var x={draw:function(t,e,n){if(e){var i=b(t,S,M);t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE),t.clear(t.COLOR_BUFFER_BIT);var o=t.canvas.width/2,r=t.canvas.height/2,a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a);var s=t.getAttribLocation(i,"a_Position");t.vertexAttribPointer(s,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(s);var l=t.getUniformLocation(i,"u_FragColor"),h=_(n.strokeStyle||"red");t.uniform4f(l,h[0]/255,h[1]/255,h[2]/255,h[3]/255),t.lineWidth(n.lineWidth||1);for(var u=0,c=e.length;u<c;u++){for(var f=e[u].geometry._coordinates,p=[],v=0;v<f.length;v++){var d=f[v],g=(d[0]-o)/o,y=(r-d[1])/r;p.push(g,y)}var x=new Float32Array(p);t.bufferData(t.ARRAY_BUFFER,x,t.STATIC_DRAW),t.drawArrays(t.LINE_STRIP,0,f.length)}}}},P=["attribute vec4 a_Position;","attribute float a_PointSize;","void main() {","gl_Position = a_Position;","gl_PointSize = a_PointSize;","}"].join(""),k=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join("");var C={draw:function(t,e,n){if(e){var i=b(t,P,k),o=t.getAttribLocation(i,"a_Position"),r=t.getAttribLocation(i,"a_PointSize"),a=t.getUniformLocation(i,"u_FragColor");t.clear(t.COLOR_BUFFER_BIT);for(var s=t.canvas.width/2,l=t.canvas.height/2,h=[],u=0,c=0;c<e.length;c++){var f=e[c].geometry._coordinates,p=(f[0]-s)/s,v=(l-f[1])/l;p<-1||1<p||v<-1||1<v||(h.push(p,v),u++)}var d=new Float32Array(h),g=u,y=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,y),t.bufferData(t.ARRAY_BUFFER,d,t.STATIC_DRAW),t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(o),t.vertexAttrib1f(r,n._size);var x=_(n.fillStyle||"red");t.uniform4f(a,x[0]/255,x[1]/255,x[2]/255,x[3]/255),t.drawArrays(t.POINTS,0,g)}}};function A(t,e,n){n=n||2;var i,o,r,a,s,l,h,u=e&&e.length,c=u?e[0]*n:t.length,f=L(t,0,c,n,!0),p=[];if(!f)return p;if(u&&(f=function(t,e,n,i){var o,r,a,s,l,h=[];for(o=0,r=e.length;o<r;o++)a=e[o]*i,s=o<r-1?e[o+1]*i:t.length,(l=L(t,a,s,i,!1))===l.next&&(l.steiner=!0),h.push(j(l));for(h.sort(Z),o=0;o<h.length;o++)N(h[o],n),n=I(n,n.next);return n}(t,e,f,n)),t.length>80*n){i=r=t[0],o=a=t[1];for(var v=n;v<c;v+=n)(s=t[v])<i&&(i=s),(l=t[v+1])<o&&(o=l),r<s&&(r=s),a<l&&(a=l);h=Math.max(r-i,a-o)}return R(f,p,n,i,o,h),p}function L(t,e,n,i,o){var r,a;if(o===0<K(t,e,n,i))for(r=e;r<n;r+=i)a=V(r,t[r],t[r+1],a);else for(r=n-i;e<=r;r-=i)a=V(r,t[r],t[r+1],a);return a&&J(a,a.next)&&(X(a),a=a.next),a}function I(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!J(i,i.next)&&0!==Y(i.prev,i,i.next))i=i.next;else{if(X(i),(i=e=i.prev)===i.next)return null;n=!0}}while(n||i!==e);return e}function R(t,e,n,i,o,r,a){if(t){!a&&r&&function(t,e,n,i){var o=t;for(;null===o.z&&(o.z=U(o.x,o.y,e,n,i)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next,o!==t;);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,n,i,o,r,a,s,l,h=1;do{for(n=t,r=t=null,a=0;n;){for(a++,i=n,e=s=0;e<h&&(s++,i=i.nextZ);e++);for(l=h;0<s||0<l&&i;)0===s?(i=(o=i).nextZ,l--):0!==l&&i?n.z<=i.z?(n=(o=n).nextZ,s--):(i=(o=i).nextZ,l--):(n=(o=n).nextZ,s--),r?r.nextZ=o:t=o,o.prevZ=r,r=o;n=i}r.nextZ=null,h*=2}while(1<a)}(o)}(t,i,o,r);for(var s,l,h=t;t.prev!==t.next;)if(s=t.prev,l=t.next,r?O(t,i,o,r):T(t))e.push(s.i/n),e.push(t.i/n),e.push(l.i/n),X(t),t=l.next,h=l.next;else if((t=l)===h){a?1===a?R(t=F(t,e,n),e,n,i,o,r,2):2===a&&D(t,e,n,i,o,r):R(I(t),e,n,i,o,r,1);break}}}function T(t){var e=t.prev,n=t,i=t.next;if(0<=Y(e,n,i))return!1;for(var o=t.next.next;o!==t.prev;){if(W(e.x,e.y,n.x,n.y,i.x,i.y,o.x,o.y)&&0<=Y(o.prev,o,o.next))return!1;o=o.next}return!0}function O(t,e,n,i){var o=t.prev,r=t,a=t.next;if(0<=Y(o,r,a))return!1;for(var s=o.x<r.x?o.x<a.x?o.x:a.x:r.x<a.x?r.x:a.x,l=o.y<r.y?o.y<a.y?o.y:a.y:r.y<a.y?r.y:a.y,h=o.x>r.x?o.x>a.x?o.x:a.x:r.x>a.x?r.x:a.x,u=o.y>r.y?o.y>a.y?o.y:a.y:r.y>a.y?r.y:a.y,c=U(s,l,e,n,i),f=U(h,u,e,n,i),p=t.nextZ;p&&p.z<=f;){if(p!==t.prev&&p!==t.next&&W(o.x,o.y,r.x,r.y,a.x,a.y,p.x,p.y)&&0<=Y(p.prev,p,p.next))return!1;p=p.nextZ}for(p=t.prevZ;p&&p.z>=c;){if(p!==t.prev&&p!==t.next&&W(o.x,o.y,r.x,r.y,a.x,a.y,p.x,p.y)&&0<=Y(p.prev,p,p.next))return!1;p=p.prevZ}return!0}function F(t,e,n){var i=t;do{var o=i.prev,r=i.next.next;!J(o,r)&&G(o,i,i.next,r)&&q(o,r)&&q(r,o)&&(e.push(o.i/n),e.push(i.i/n),e.push(r.i/n),X(i),X(i.next),i=t=r),i=i.next}while(i!==t);return i}function D(t,e,n,i,o,r){var a,s,l=t;do{for(var h=l.next.next;h!==l.prev;){if(l.i!==h.i&&(s=h,(a=l).next.i!==s.i&&a.prev.i!==s.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&G(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(a,s)&&q(a,s)&&q(s,a)&&function(t,e){var n=t,i=!1,o=(t.x+e.x)/2,r=(t.y+e.y)/2;for(;n.y>r!=n.next.y>r&&o<(n.next.x-n.x)*(r-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next,n!==t;);return i}(a,s))){var u=H(l,h);return l=I(l,l.next),u=I(u,u.next),R(l,e,n,i,o,r),void R(u,e,n,i,o,r)}h=h.next}l=l.next}while(l!==t)}function Z(t,e){return t.x-e.x}function N(t,e){if(e=function(t,e){var n,i=e,o=t.x,r=t.y,a=-1/0;do{if(r<=i.y&&r>=i.next.y){var s=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=o&&a<s){if((a=s)===o){if(r===i.y)return i;if(r===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(o===a)return n.prev;var l,h=n,u=n.x,c=n.y,f=1/0;i=n.next;for(;i!==h;)o>=i.x&&i.x>=u&&W(r<c?o:a,r,u,c,r<c?a:o,r,i.x,i.y)&&((l=Math.abs(r-i.y)/(o-i.x))<f||l===f&&i.x>n.x)&&q(i,t)&&(n=i,f=l),i=i.next;return n}(t,e)){var n=H(e,t);I(n,n.next)}}function U(t,e,n,i,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)/o)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)/o)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function j(t){for(var e=t,n=t;e.x<n.x&&(n=e),(e=e.next)!==t;);return n}function W(t,e,n,i,o,r,a,s){return 0<=(o-a)*(e-s)-(t-a)*(r-s)&&0<=(t-a)*(i-s)-(n-a)*(e-s)&&0<=(n-a)*(r-s)-(o-a)*(i-s)}function Y(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function J(t,e){return t.x===e.x&&t.y===e.y}function G(t,e,n,i){return!!(J(t,e)&&J(n,i)||J(t,i)&&J(n,e))||0<Y(t,e,n)!=0<Y(t,e,i)&&0<Y(n,i,t)!=0<Y(n,i,e)}function q(t,e){return Y(t.prev,t,t.next)<0?0<=Y(t,e,t.next)&&0<=Y(t,t.prev,e):Y(t,e,t.prev)<0||Y(t,t.next,e)<0}function H(t,e){var n=new Q(t.i,t.x,t.y),i=new Q(e.i,e.x,e.y),o=t.next,r=e.prev;return(t.next=e).prev=t,(n.next=o).prev=n,(i.next=n).prev=i,(r.next=i).prev=r,i}function V(t,e,n,i){var o=new Q(t,e,n);return i?(o.next=i.next,(o.prev=i).next.prev=o,i.next=o):(o.prev=o).next=o,o}function X(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Q(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function K(t,e,n,i){for(var o=0,r=e,a=n-i;r<n;r+=i)o+=(t[a]-t[r])*(t[r+1]+t[a+1]),a=r;return o}A.deviation=function(t,e,n,i){var o=e&&e.length,r=o?e[0]*n:t.length,a=Math.abs(K(t,0,r,n));if(o)for(var s=0,l=e.length;s<l;s++){var h=e[s]*n,u=s<l-1?e[s+1]*n:t.length;a-=Math.abs(K(t,h,u,n))}var c=0;for(s=0;s<i.length;s+=3){var f=i[s]*n,p=i[s+1]*n,v=i[s+2]*n;c+=Math.abs((t[f]-t[v])*(t[p+1]-t[f+1])-(t[f]-t[p])*(t[v+1]-t[f+1]))}return 0===a&&0===c?0:Math.abs((c-a)/a)},A.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,o=0;o<t.length;o++){for(var r=0;r<t[o].length;r++)for(var a=0;a<e;a++)n.vertices.push(t[o][r][a]);0<o&&(i+=t[o-1].length,n.holes.push(i))}return n};var $=["attribute vec4 a_Position;","void main() {","gl_Position = a_Position;","gl_PointSize = 30.0;","}"].join(""),tt=["precision mediump float;","uniform vec4 u_FragColor;","void main() {","gl_FragColor = u_FragColor;","}"].join("");var et={draw:function(t,e,n){if(e){t.clear(t.COLOR_BUFFER_BIT),t.viewport(0,0,t.canvas.width,t.canvas.height);var i=b(t,$,tt);t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE);var o=t.canvas.width/2,r=t.canvas.height/2;t.bindBuffer(t.ARRAY_BUFFER,t.createBuffer()),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,t.createBuffer());var a=t.getAttribLocation(i,"a_Position");t.vertexAttribPointer(a,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(a);var s=t.getUniformLocation(i,"u_FragColor"),l=_(n.fillStyle||"red");t.uniform4f(s,l[0]/255,l[1]/255,l[2]/255,l[3]/255),t.lineWidth(n.lineWidth||1);for(var h=[],u=[],c=0,f=0,p=e.length;f<p;f++){var v=A.flatten(e[f].geometry._coordinates||e[f].geometry.coordinates),d=v.vertices;c=h.length/2;for(var g=0;g<d.length;g+=2)d[g]=(d[g]-o)/o,d[g+1]=(r-d[g+1])/r;for(65536<(h.length+d.length)/2&&(t.bufferData(t.ARRAY_BUFFER,new Float32Array(h),t.STATIC_DRAW),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(u),t.STATIC_DRAW),t.drawElements(t.TRIANGLES,u.length,t.UNSIGNED_SHORT,0),h.length=0,c=u.length=0),g=0;g<d.length;g++)h.push(d[g]);var y=A(d,v.holes,v.dimensions);for(g=0;g<y.length;g++)u.push(y[g]+c)}t.bufferData(t.ARRAY_BUFFER,new Float32Array(h),t.STATIC_DRAW),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(u),t.STATIC_DRAW),t.drawElements(t.TRIANGLES,u.length,t.UNSIGNED_SHORT,0),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}}},nt=function(t,e,n){var i=e instanceof B?e.get():e;0<i.length&&("LineString"==i[0].geometry.type?x.draw(t,i,n):"Polygon"==i[0].geometry.type||"MultiPolygon"==i[0].geometry.type?et.draw(t,i,n):C.draw(t,i,n))},it=function(t,e,n){t.save();for(var i=e instanceof B?e.get():e,o={},r=n._size||n.size||50,a=n.offset||{x:0,y:0},s=0;s<i.length;s++){var l=i[s].geometry._coordinates||i[s].geometry.coordinates;o[u=Math.floor((l[0]-a.x)/r)+","+Math.floor((l[1]-a.y)/r)]||(o[u]=0),o[u]+=~~(i[s].count||1)}var h=new z({max:n.max||100,gradient:n.gradient});for(var u in o)u=u.split(","),t.beginPath(),t.rect(u[0]*r+.5+a.x,u[1]*r+.5+a.y,r,r),t.fillStyle=h.getColor(o[u]),t.fill(),n.strokeStyle&&n.lineWidth&&t.stroke();if(n.label&&!1!==n.label.show)for(var u in t.fillStyle=n.label.fillStyle||"white",n.label.font&&(t.font=n.label.font),n.label.shadowColor&&(t.shadowColor=n.label.shadowColor),n.label.shadowBlur&&(t.shadowBlur=n.label.shadowBlur),o){var c=o[u=u.split(",")],f=t.measureText(c).width;t.fillText(c,u[0]*r+.5+a.x+r/2-f/2,u[1]*r+.5+a.y+r/2+5)}t.restore()};var ot=function(t,e,n){t.save();var i=e instanceof B?e.get():e;for(var o in n)t[o]=n[o];for(var r=n.offset||{x:10,y:10},a=n._size||n.size||40,s=2*(a=a/2/Math.sin(Math.PI/3))*Math.sin(Math.PI/3),l=1.5*a,h={},u=0;u<i.length;u++){var c=i[u].geometry._coordinates||i[u].geometry.coordinates,f=(c[1]-r.y)/l,p=Math.round(f),v=(c[0]-r.x)/s-(1&p?.5:0),d=Math.round(v),g=f-p;if(1<3*Math.abs(g)){var y=v-d,x=d+(v<d?-1:1)/2,m=p+(f<p?-1:1),w=v-x,b=f-m;w*w+b*b<y*y+g*g&&(d=x+(1&p?1:-1)/2,p=m)}var _=d+"-"+p,S=h[_];S?S.push(i[u]):((S=h[_]=[i[u]]).i=d,S.j=p,S.x=(d+(1&p?.5:0))*s,S.y=p*l)}var M,P,k,E,C=new z({max:n.max||100,maxSize:a,gradient:n.gradient});for(var o in h){var A=h[o];t.beginPath();for(var L=0;L<6;L++){var I=(M={x:A.x+r.x,y:A.y+r.y},P=a,void 0,k=60*L+30,E=Math.PI/180*k,[M.x+P*Math.cos(E),M.y+P*Math.sin(E)]);t.lineTo(I[0],I[1])}t.closePath();var R=0;for(u=0;u<A.length;u++)R+=A[u].count||1;A.count=R,t.fillStyle=C.getColor(R),t.fill(),n.strokeStyle&&n.lineWidth&&t.stroke()}if(n.label&&!1!==n.label.show)for(var o in t.fillStyle=n.label.fillStyle||"white",n.label.font&&(t.font=n.label.font),n.label.shadowColor&&(t.shadowColor=n.label.shadowColor),n.label.shadowBlur&&(t.shadowBlur=n.label.shadowBlur),h){var T=(A=h[o]).count;T=T<0?T.toFixed(2):~~T;var O=t.measureText(T).width;t.fillText(T,A.x+r.x-O/2,A.y+r.y+5)}t.restore()},rt=function(t,e,n){var i=e instanceof B?e.get():e;for(var o in t.save(),n)t[o]=n[o];var r=n.offset||{x:0,y:0},a=[],s=n._size||n.size;s?t.font="bold "+s+"px Arial":s=12;var l=n.textKey||"text";if(n.textAlign||(t.textAlign="center"),n.textBaseline||(t.textBaseline="middle"),n.avoid)for(var h=0,u=i.length;h<u;h++){var c=(x=i[h].geometry._coordinates||i[h].geometry.coordinates)[0]+r.x,f=x[1]+r.y,p=i[h][l],v=t.measureText(p).width,d=c-v/2,g=f-s/2,y={sw:{x:d,y:g+s},ne:{x:d+v,y:g}};at(a,y)||(a.push(y),d+=v/2,g+=s/2,t.fillText(p,d,g))}else for(h=0,u=i.length;h<u;h++){var x;c=(x=i[h].geometry._coordinates||i[h].geometry.coordinates)[0]+r.x,f=x[1]+r.y,p=i[h][l];t.fillText(p,c,f)}t.restore()};function at(t,e){for(var n=0;n<t.length;n++)if(st(t[n],e))return!0;return!1}function st(t,e){var n=Math.min(t.ne.x,e.ne.x),i=Math.min(t.sw.y,e.sw.y),o=Math.max(t.sw.x,e.sw.x),r=Math.max(t.ne.y,e.ne.y);return o<n&&r<i}var lt=function(t,e,n){var i=e instanceof B?e.get():e;t.fillStyle="white",t.textAlign="center",t.textBaseline="middle";for(var o=n.offset||{x:0,y:0},r=0,a=i.length;r<a;r++)if(i[r].geometry){var s=i[r].deg||n.deg,l=i[r].icon||n.icon,h=i[r].geometry._coordinates||i[r].geometry.coordinates,u=h[0],c=h[1];s&&(t.save(),t.translate(u,c),t.rotate(s*Math.PI/180),t.translate(-u,-c));var f=n._width||n.width||l.width,p=n._height||n.height||l.height;u=u-f/2+o.x,c=c-p/2+o.y,n.sx&&n.sy&&n.swidth&&n.sheight&&n.width&&n.height?t.drawImage(l,n.sx,n.sy,n.swidth,n.sheight,u,c,f,p):n.width&&n.height?t.drawImage(l,u,c,f,p):t.drawImage(l,u,c),s&&t.restore()}};"undefined"!=typeof window&&requestAnimationFrame(function t(e){requestAnimationFrame(t);E.update(e)});var ht=function(){function i(t,e,n){s(this,i),e instanceof B||(e=new B(e)),this.dataSet=e,this.map=t}return e(i,[{key:"getDefaultContextConfig",value:function(){return{globalAlpha:1,globalCompositeOperation:"source-over",imageSmoothingEnabled:!0,strokeStyle:"#000000",fillStyle:"#000000",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"rgba(0, 0, 0, 0)",lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,lineDashOffset:0,font:"10px sans-serif",textAlign:"start",textBaseline:"alphabetic"}}},{key:"initDataRange",value:function(t){var e=this;if(e.intensity=new z({maxSize:e.options.maxSize,minSize:e.options.minSize,gradient:e.options.gradient,max:e.options.max||this.dataSet.getMax("count")}),e.category=new c(e.options.splitList),e.choropleth=new f(e.options.splitList),void 0===e.options.splitList&&e.category.generateByDataSet(this.dataSet,e.options.color),void 0===e.options.splitList){var n=e.options.min||this.dataSet.getMin("count"),i=e.options.max||this.dataSet.getMax("count");e.choropleth.generateByMinMax(n,i)}}},{key:"getLegend",value:function(t){this.options.draw;return"intensity"==this.options.draw||"heatmap"==this.options.draw?this.intensity.getLegend(t):"category"==this.options.draw?this.category.getLegend(t):void 0}},{key:"processData",value:function(t){var e=this,n=e.options.draw;if("bubble"==n||"intensity"==n||"category"==n||"choropleth"==n||"simple"==n)for(var i=0;i<t.length;i++){var o=t[i];"bubble"==e.options.draw?t[i]._size=e.intensity.getSize(o.count):t[i]._size=void 0;var r="_fillStyle";"LineString"!==t[i].geometry.type&&"stroke"!==e.options.styleType||(r="_strokeStyle"),"intensity"==e.options.draw?t[i][r]=e.intensity.getColor(o.count):"category"==e.options.draw?t[i][r]=e.category.get(o.count):"choropleth"==e.options.draw&&(t[i][r]=e.choropleth.get(o.count))}}},{key:"isEnabledTime",value:function(){var t=this.options.animation;return t&&!(!1===t.enabled)}},{key:"argCheck",value:function(t){"heatmap"==t.draw&&t.strokeStyle&&console.warn("[heatmap] options.strokeStyle is discard, pleause use options.strength [eg: options.strength = 0.1]")}},{key:"drawContext",value:function(t,e,n,i){var o=this;switch(o.options.draw){case"heatmap":g.draw(t,e,o.options);break;case"grid":case"honeycomb":o.options.offset={x:i.x,y:i.y},"grid"==o.options.draw?it(t,e,o.options):ot(t,e,o.options);break;case"text":rt(t,e,o.options);break;case"icon":lt(t,e,o.options);break;case"clip":t.save(),t.fillStyle=o.options.fillStyle||"rgba(0, 0, 0, 0.5)",t.fillRect(0,0,t.canvas.width,t.canvas.height),r.draw(t,e,o.options),t.beginPath(),m.drawDataSet(t,e,o.options),t.clip(),p(t),t.restore();break;default:"webgl"==o.options.context?nt(o.canvasLayer.canvas.getContext("webgl"),e,o.options):r.draw(t,e,o.options)}}},{key:"isPointInPath",value:function(t,e){var n;t=this.canvasLayer.canvas.getContext(this.context);if(this.dataSet._rt){var i=new BMap.Pixel(e.x-3,e.y-3),o=new BMap.Pixel(e.x+3,e.y+3),r=this.map.pixelToPoint(i),a=this.map.pixelToPoint(o);n=this.dataSet.getByBbox(r,a)}else n=this.dataSet.get();for(var s=0;s<n.length;s++){t.beginPath(),m.draw(t,n[s],this.options);var l=e.x*this.canvasLayer.devicePixelRatio,h=e.y*this.canvasLayer.devicePixelRatio;if(-1<(n[s].geometry&&n[s].geometry.type).indexOf("Polygon")){if(t.isPointInPath(l,h))return n[s]}else if(t.isPointInStroke&&t.isPointInStroke(l,h))return n[s]}}},{key:"clickEvent",value:function(t,e){if(this.options.methods){var n=this.isPointInPath(this.getContext(),t);n?this.options.methods.click(n,e):this.options.methods.click(null,e)}}},{key:"mousemoveEvent",value:function(t,e){if(this.options.methods){var n=this.isPointInPath(this.getContext(),t);n?this.options.methods.mousemove(n,e):this.options.methods.mousemove(null,e)}}},{key:"update",value:function(t,e){var n=t.options,i=this.options;for(var o in n)i[o]=n[o];this.init(i),!1!==e&&this.draw()}},{key:"setOptions",value:function(t){this.dataSet.reset(),this.init(t),this.draw()}},{key:"set",value:function(t){var e=this.getContext(),n=this.getDefaultContextConfig();for(var i in n)e[i]=n[i];this.init(t.options),this.draw()}},{key:"destroy",value:function(){this.unbindEvent(),this.hide()}},{key:"initAnimator",value:function(){var t=this,e=t.options.animation;if("time"==t.options.draw||t.isEnabledTime()){e.stepsRange||(e.stepsRange={start:this.dataSet.getMin("time")||0,end:this.dataSet.getMax("time")||0}),this.steps={step:e.stepsRange.start},t.animator=new E.Tween(this.steps).onUpdate(function(){t._canvasUpdate(this.step)}).repeat(1/0),this.addAnimatorEvent();var n=1e3*e.duration||5e3;t.animator.to({step:e.stepsRange.end},n),t.animator.start()}else t.animator&&t.animator.stop()}},{key:"addAnimatorEvent",value:function(){}},{key:"animatorMovestartEvent",value:function(){var t=this.options.animation;this.isEnabledTime()&&this.animator&&(this.steps.step=t.stepsRange.start,this.animator.stop())}},{key:"animatorMoveendEvent",value:function(){this.isEnabledTime()&&this.animator&&this.animator.start()}}]),i}(),ut=function(t){function a(t,e,n){s(this,a);var i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,t,e,n)),o=i;n=n||{},i.clickEvent=i.clickEvent.bind(i),i.mousemoveEvent=i.mousemoveEvent.bind(i),o.init(n),o.argCheck(n),o.transferToMercator();var r=i.canvasLayer=new l({map:t,context:i.context,paneName:n.paneName,mixBlendMode:n.mixBlendMode,enableMassClear:n.enableMassClear,zIndex:n.zIndex,update:function(){o._canvasUpdate()}});return e.on("change",function(){o.transferToMercator(),r.draw()}),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(a,ht),e(a,[{key:"clickEvent",value:function(t){var e=t.pixel;i(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"clickEvent",this).call(this,e,t)}},{key:"mousemoveEvent",value:function(t){var e=t.pixel;i(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"mousemoveEvent",this).call(this,e,t)}},{key:"bindEvent",value:function(t){this.unbindEvent();var e=this.map;this.options.methods&&(this.options.methods.click&&(e.setDefaultCursor("default"),e.addEventListener("click",this.clickEvent)),this.options.methods.mousemove&&e.addEventListener("mousemove",this.mousemoveEvent))}},{key:"unbindEvent",value:function(t){var e=this.map;this.options.methods&&(this.options.methods.click&&e.removeEventListener("click",this.clickEvent),this.options.methods.mousemove&&e.removeEventListener("mousemove",this.mousemoveEvent))}},{key:"transferToMercator",value:function(){var n=this.map.getMapType().getProjection();if("bd09mc"!==this.options.coordType){var t=this.dataSet.get();t=this.dataSet.transferCoordinate(t,function(t){var e=n.lngLatToPoint({lng:t[0],lat:t[1]});return[e.x,e.y]},"coordinates","coordinates_mercator"),this.dataSet._set(t)}}},{key:"getContext",value:function(){return this.canvasLayer.canvas.getContext(this.context)}},{key:"_canvasUpdate",value:function(n){if(this.canvasLayer){var t=this,i=t.options.animation,e=this.canvasLayer._map,o=Math.pow(2,18-e.getZoom()),r=e.getMapType().getProjection().lngLatToPoint(e.getCenter()),a=new BMap.Pixel(r.x-e.getSize().width/2*o,r.y+e.getSize().height/2*o),s=this.getContext();if(t.isEnabledTime()){if(void 0===n)return void p(s);"2d"==this.context&&(s.save(),s.globalCompositeOperation="destination-out",s.fillStyle="rgba(0, 0, 0, .1)",s.fillRect(0,0,s.canvas.width,s.canvas.height),s.restore())}else p(s);if("2d"==this.context)for(var l in t.options)s[l]=t.options[l];else s.clear(s.COLOR_BUFFER_BIT);if(!(t.options.minZoom&&e.getZoom()<t.options.minZoom||t.options.maxZoom&&e.getZoom()>t.options.maxZoom)){var h=1;"2d"!=this.context&&(h=this.canvasLayer.devicePixelRatio);var u={fromColumn:"bd09mc"==t.options.coordType?"coordinates":"coordinates_mercator",transferCoordinate:function(t){return[(t[0]-a.x)/o*h,(a.y-t[1])/o*h]}};void 0!==n&&(u.filter=function(t){var e=i.trails||10;return!!(n&&t.time>n-e&&t.time<n)});var c=t.dataSet.get(u);this.processData(c);var f=e.pointToPixel(new BMap.Point(0,0));"m"==t.options.unit?(t.options.size&&(t.options._size=t.options.size/o),t.options.width&&(t.options._width=t.options.width/o),t.options.height&&(t.options._height=t.options.height/o)):(t.options._size=t.options.size,t.options._height=t.options.height,t.options._width=t.options.width),this.drawContext(s,c,t.options,f),t.options.updateCallback&&t.options.updateCallback(n)}}}},{key:"init",value:function(t){var e=this;e.options=t,this.initDataRange(t),this.context=e.options.context||"2d",e.options.zIndex&&this.canvasLayer&&this.canvasLayer.setZIndex(e.options.zIndex),e.options.max&&this.intensity.setMax(e.options.max),e.options.min&&this.intensity.setMin(e.options.min),this.initAnimator(),this.bindEvent()}},{key:"addAnimatorEvent",value:function(){this.map.addEventListener("movestart",this.animatorMovestartEvent.bind(this)),this.map.addEventListener("moveend",this.animatorMoveendEvent.bind(this))}},{key:"show",value:function(){this.map.addOverlay(this.canvasLayer)}},{key:"hide",value:function(){this.map.removeOverlay(this.canvasLayer)}},{key:"draw",value:function(){this.canvasLayer.draw()}}]),a}(),ct={getDataSet:function(t){for(var e=[],n=t.features,i=0;i<n.length;i++){var o=n[i],r=o.geometry,a=o.properties,s={};for(var l in a)s[l]=a[l];s.geometry=r,e.push(s)}return new B(e)}};t.version="2.0.20",t.canvasClear=p,t.canvasResolutionScale=function(t){var e=window.devicePixelRatio||1;t.canvas.width=t.canvas.width*e,t.canvas.height=t.canvas.height*e,t.canvas.style.width=t.canvas.width/e+"px",t.canvas.style.height=t.canvas.height/e+"px",t.scale(e,e)},t.canvasDrawSimple=r,t.Map=o,t.baiduMapCanvasLayer=l,t.baiduMapLayer=ut,t.DataSet=B,t.geojson=ct,Object.defineProperty(t,"__esModule",{value:!0})});